<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dynamic Summaries Blog</title>
<style>
    body {
        font-family: 'Pragmatica Extended', sans-serif;
        background-color: #EBFC72; /* Switched background color with text color */
        color: black; /* Switched text color with background color */
    }
    .summary {
        /* border: 1px solid #ddd; */
        margin: 20px 0;
        padding: 15px;
        border-radius: 5px;
        background-color: #EBFC72; /* Switched background color with text color */
        color: black; /* Switched text color with background color */
        font-family: 'Helvetica Neue', sans-serif;
    }
    .summary h2 {
        margin-top: 0;
    }
</style>
</head>
<body>

<div id="blog-posts"></div>

<script>
fetch('https://raw.githubusercontent.com/DanielTea/github-trending-analysis/main/trending_repositories_summary.csv')
    .then(response => response.text())
    .then(csvText => {
        function parseCSV(csvString) {
            const rows = csvString.trim().split("\n");
            const headers = rows.shift().split(",").map(header => header.trim());
            return rows.map(row => {
                let inQuotes = false;
                let field = '';
                let fields = [];
                for (let i = 0; i < row.length; i++) {
                    const char = row[i];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        fields.push(field);
                        field = '';
                    } else {
                        field += char;
                    }
                }
                fields.push(field); // Add last field
                return headers.reduce((obj, header, index) => {
                    obj[header] = fields[index];
                    return obj;
                }, {});
            });
        }

        function insertSummaries(data) {
            const container = document.getElementById("blog-posts");
            data.filter(item => item['Repository-Creation-Date'] && item['Blog-Title'] && item['Blog-Post'] && item['Star-Count-Delta'] && item['Classification'] && item['Repository-Link'] && ["Artificial Intelligence", "Machine Learning", "Language Models", "Deep Learning", "Computer Vision", "Data Science", "AI"].includes(item['Classification']) && item['Repository-Creation-Date'] !== '0' && item['Repository-Creation-Date'] !== '').sort((a, b) => {
                const starCountA = parseInt(extractStarCount(a['Star-Count-Delta']).replace(' stars', ''));
                const starCountB = parseInt(extractStarCount(b['Star-Count-Delta']).replace(' stars', ''));
                return starCountB - starCountA;
            }).slice(0, 10).forEach(item => {
                const article = document.createElement("article");
                article.className = "summary";
                article.innerHTML = `
                <h2>${item['Blog-Title']}</h2><p>${item['Blog-Post']}</p>
                <span style="font-size: 20px;">${item['Star-Count-Delta']}</span>
                <p style="font-size: 20px;">${item['Classification']}</p>
                <p style="font-size: 20px;">${item['Repository-Creation-Date']}</p>
                <p>${isWithinOneMonth(item['Repository-Creation-Date']) ? 1 : 0}</p>
                `;

                // Create a preview card for the GitHub repository
                const card = document.createElement("div");
                card.innerHTML = `<a href="${item['Repository-Link']}" target="_blank"><img src="https://gh-card.dev/repos/${item['Repository-Link'].split('/')[3]}/${item['Repository-Link'].split('/')[4]}.svg" alt="GitHub Repository Card for ${item['Repository-Link'].split('/')[3]}/${item['Repository-Link'].split('/')[4]}" style="cursor: pointer;"></a>`;
                container.appendChild(article);
                container.appendChild(card);
            });
        }

        function extractStarCount(starCountDelta) {
            const starCount = parseInt(starCountDelta.replace(/,/g, '').match(/\d+/)[0]);
            return `${starCount} stars`;
        }

        function isWithinOneMonth(dateString) {
            const repositoryCreationDate = new Date(dateString);
            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            const oneMonthAgoUTC = new Date(oneMonthAgo.toUTCString()); // Convert to UTC to compare accurately
            return repositoryCreationDate > oneMonthAgoUTC;
        }

        const parsedData = parseCSV(csvText);
        insertSummaries(parsedData);
    })
    .catch(err => console.error('Failed to fetch CSV:', err));
</script>
</body>
</html>
