<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dynamic Summaries Blog</title>
<style>
    body {
        font-family: 'Pragmatica Extended', sans-serif;
        background-color: #EBFC72; /* Switched background color with text color */
        color: black; /* Switched text color with background color */
    }
    .summary {
        /* border: 1px solid #ddd; */
        margin: 20px 0;
        padding: 15px;
        border-radius: 5px;
        background-color: #EBFC72; /* Switched background color with text color */
        color: black; /* Switched text color with background color */
        font-family: 'Helvetica Neue', sans-serif;
    }
    .summary h2 {
        margin-top: 0;
    }
</style>
</head>
<body>

<div id="blog-posts"></div>

<script>
fetch('https://raw.githubusercontent.com/DanielTea/github-trending-analysis/main/trending_repositories_summary.csv')
    .then(response => response.text())
    .then(csvText => {
        function parseCSV(csvString) {
            const rows = csvString.trim().split("\n");
            const headers = rows.shift().split(",").map(header => header.trim());
            return rows.map(row => {
                let inQuotes = false;
                let field = '';
                let fields = [];
                for (let i = 0; i < row.length; i++) {
                    const char = row[i];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        fields.push(field);
                        field = '';
                    } else {
                        field += char;
                    }
                }
                fields.push(field); // Add last field
                return headers.reduce((obj, header, index) => {
                    obj[header] = fields[index];
                    return obj;
                }, {});
            });
        }

        function insertSummaries(data) {
            const container = document.getElementById("blog-posts");
            data.forEach(item => {
                const article = document.createElement("article");
                article.className = "summary";
                article.innerHTML = `<h2>${item['Blog-Title']}</h2><p>${item['Blog-Post']}</p><span style="font-size: 20px;">Star-Count-Delta: ${item['Star-Count-Delta']}</span>`;

                // Create a preview card for the GitHub repository
                const card = document.createElement("div");
                card.innerHTML = `<a href="${item['Repository-Link']}" target="_blank"><img src="https://gh-card.dev/repos/${item['Repository-Link'].split('/')[3]}/${item['Repository-Link'].split('/')[4]}.svg" alt="GitHub Repository Card for ${item['Repository-Link'].split('/')[3]}/${item['Repository-Link'].split('/')[4]}" style="cursor: pointer;"></a>`;
                container.appendChild(article);
                container.appendChild(card);
            });
        }

        const parsedData = parseCSV(csvText);
        insertSummaries(parsedData);
    })
    .catch(err => console.error('Failed to fetch CSV:', err));
</script>
</body>
</html>
